<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .expected { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>üß™ Dashboard P&L Fix Verification</h1>
    
    <div id="results"></div>
    
    <script>
        async function testDashboardAPI() {
            const results = document.getElementById('results');
            
            try {
                // Test capital management API
                const response = await fetch('http://localhost:8000/api/dashboard/capital-management');
                const data = await response.json();
                
                if (data.status === 'success') {
                    const capital = data.data;
                    
                    // Expected corrected values
                    const expectedCurrent = 88944.75;
                    const expectedTotalPnL = -11055.25;
                    
                    let html = '<h2>üìä API Test Results:</h2>';
                    
                    // Check current capital
                    if (Math.abs(capital.current_capital - expectedCurrent) < 1) {
                        html += `<div class="result success">‚úÖ Current Capital: ‚Çπ${capital.current_capital.toLocaleString('en-IN')} (Correct)</div>`;
                    } else {
                        html += `<div class="result error">‚ùå Current Capital: ‚Çπ${capital.current_capital.toLocaleString('en-IN')} (Expected: ‚Çπ${expectedCurrent.toLocaleString('en-IN')})</div>`;
                    }
                    
                    // Check total P&L
                    if (Math.abs(capital.total_pnl - expectedTotalPnL) < 1) {
                        html += `<div class="result success">‚úÖ Total P&L: ‚Çπ${capital.total_pnl.toLocaleString('en-IN')} (Correct)</div>`;
                    } else {
                        html += `<div class="result error">‚ùå Total P&L: ‚Çπ${capital.total_pnl.toLocaleString('en-IN')} (Expected: ‚Çπ${expectedTotalPnL.toLocaleString('en-IN')})</div>`;
                    }
                    
                    html += `<div class="result expected">üìã Expected Values:</div>`;
                    html += `<div class="result expected">   Current Capital: ‚Çπ${expectedCurrent.toLocaleString('en-IN')}</div>`;
                    html += `<div class="result expected">   Total P&L: ‚Çπ${expectedTotalPnL.toLocaleString('in-IN')}</div>`;
                    
                    html += '<h2>üîß What Was Fixed:</h2>';
                    html += '<div class="result success">‚úÖ Backend API now uses corrected P&L formula</div>';
                    html += '<div class="result success">‚úÖ Frontend updated to use new API endpoint</div>';
                    html += '<div class="result success">‚úÖ Disabled conflicting paper_trading_status.js</div>';
                    html += '<div class="result success">‚úÖ Updated cache-busting parameter</div>';
                    
                    html += '<h2>üö® Dashboard Should Now Show:</h2>';
                    html += '<div class="result expected">üí∞ Capital Management</div>';
                    html += '<div class="result expected">STARTING CAPITAL    ‚Çπ1,00,000</div>';
                    html += '<div class="result expected">CURRENT CAPITAL     ‚Çπ88,944.75</div>';
                    html += '<div class="result expected">TODAY\'S P&L         ‚Çπ0.00 (0.00%)</div>';
                    html += '<div class="result expected">TOTAL P&L           ‚Çπ-11,055.25 (-11.06%)</div>';
                    
                    results.innerHTML = html;
                    
                } else {
                    results.innerHTML = `<div class="result error">‚ùå API Error: ${data}</div>`;
                }
                
            } catch (error) {
                results.innerHTML = `<div class="result error">‚ùå Network Error: ${error.message}</div>`;
            }
        }
        
        // Run test on page load
        testDashboardAPI();
        
        // Auto-refresh every 5 seconds
        setInterval(testDashboardAPI, 5000);
    </script>
</body>
</html>
